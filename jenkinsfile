pipeline {      // declarative pipeline

    agent any

    environment {
            fromEmail = "bdkakde@rediffmail.com"
            recipientEmails = "bdkakde@gmail.com, ubkakde@gmail.com"
            APP_NAME = 'Amazon'
        }
    stages
    {
        stage('checkout from SCM repo')
        {
            steps
            {
               git 'https://github.com/bdkakde/SBAFramework.git'
            }
        }

        stage ('Test')          // run tests
        {
            steps
            {
              bat 'gradle runSerial'
            }

        post {
          always {
            script {
              allure([
                includeProperties: false,
                jdk: '',
                properties: [],
                reportBuildPolicy: 'ALWAYS',
                results: [[path: 'target/allure-results']]
              ])
            }
          }
         }
        }
    }

 /*        post{
              always{
                      mail to: "${recipientEmails}",
                      subject: "jenkins build:${currentBuild.currentResult}: ${env.JOB_NAME}",
                       body: "${currentBuild.currentResult}: Job ${env.JOB_NAME}\nMore Info can be found here: ${env.BUILD_URL}"

                    }
        } */

            post {
                failure {
                    emailext attachmentsPattern: 'allure-report.zip',
                            body: "${currentBuild.currentResult}: Job ${env.JOB_NAME}\nMore Info can be found here: ${env.BUILD_URL},
                            subject: "jenkins build:${currentBuild.currentResult}: ${env.JOB_NAME}",
                            mimeType: 'text/html',
                            to: "bdkakde@gmail.com"
                    }
                 success {
                       emailext attachmentsPattern: 'allure-report.zip',
                            body: "${currentBuild.currentResult}: Job ${env.JOB_NAME}\nMore Info can be found here: ${env.BUILD_URL},
                            subject: "jenkins build:${currentBuild.currentResult}: ${env.JOB_NAME}",
                            mimeType: 'text/html',
                            to: "bdkakde@gmail.com"
                  }
            }
  }
